#!/bin/bash

BIN_NAME=$(basename "$0")
COMMAND_NAME=$1

SMU_PATH="$HOME"/set-me-up

help () {
  echo "Usage: $BIN_NAME <command> <option>"
  echo
  echo "Commands:"
  echo "   clean             Clean up caches (brew, nvm, gem)"
  echo "   edit              Open dotfiles in visual-studio-code"
  echo "   update <\$BRANCH> Update set-me-up using given \$BRANCH from nicholasadamou/dotfiles"
  echo "   help              This help message"
}

edit() {
	command -v "code" &>/dev/null && \
  		sh -c "code $SMU_PATH"
}

update() {
	branch="$1"

	rm -rf "$SMU_PATH"

	bash <(curl -s -L https://raw.githubusercontent.com/nicholasadamou/dotfiles/"$branch"/.dotfiles/modules/install.sh)
}

clean() {
	command -v "brew" &>/dev/null && \
		brew cleanup

	command -v "gem" &>/dev/null && \
		gem cleanup

	command -v "nvm" &>/dev/null && {
		. "$NVM_DIR/nvm.sh" && \
    nvm cache clear
  }

  apt cache clean
}

case "$COMMAND_NAME" in
  "" | "-h" | "--help")
    help
    ;;
  *)
    shift
    "${COMMAND_NAME}" "$@"
    if [[ $? = 127 ]]; then
      echo "'$COMMAND_NAME' is not a known command." >&2
      help
      exit 1
    fi
    ;;
esac
